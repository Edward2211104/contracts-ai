param(
    [string]$Entry = "main.py"  # archivo Python a ejecutar: main.py o llm_server.py
)

# Siempre trabajar en la raíz del proyecto
Set-Location "C:\Users\Usuario\contracts-ai\contracts-llm"

$python = ".venv\Scripts\python.exe"
if (-not (Test-Path $python)) {
    Write-Host "[ERROR] No se encontró $python. ¿Se creó la venv?" -ForegroundColor Red
    exit 1
}

# Crear carpeta de logs si no existe
$logDir = "logs"
if (-not (Test-Path $logDir)) {
    New-Item -ItemType Directory -Path $logDir | Out-Null
}

$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$logFile = Join-Path $logDir "llm_server_$timestamp.log"

Write-Host "[LLM] Usando Python: $python" -ForegroundColor Cyan
Write-Host "[LLM] Ejecutando:  $python -X dev -u $Entry" -ForegroundColor Green
Write-Host "[LLM] Log:         $logFile" -ForegroundColor Green
Write-Host "[LLM] (Se quedará corriendo aquí, mostrando todos los logs)" -ForegroundColor Yellow

# Ejecutar el servidor en primer plano, mandando stdout+stderr al log y a la consola
& $python -X dev -u $Entry *>&1 | Tee-Object -FilePath $logFile
